name: è§„åˆ™è‡ªåŠ¨æ›´æ–°

on:
  schedule:
    - cron: '0 22 * * *'  # åŒ—äº¬æ—¶é—´æ—©ä¸Š6ç‚¹
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: æ£€å‡ºä»“åº“
        uses: actions/checkout@v3
        with:
          ref: main
          clean: true

      - name: ç½‘ç»œæºç¼“å­˜
        uses: actions/cache@v3
        with:
          path: ~/.cache/adblock-sources
          key: sources-${{ hashFiles('sources.txt') }}
          restore-keys: |
            sources-

      - name: å®‰è£…ä¾èµ–
        run: |
          sudo apt-get update
          sudo apt-get install -y curl ca-certificates parallel

      - name: æ‰§è¡Œè§„åˆ™å¤„ç†
        run: |
          chmod +x scripts/process.sh
          rm -f adblock.txt reports.txt README.md
          ./scripts/process.sh
          ls -lh adblock.txt reports.txt README.md

      - name: æäº¤æ›´æ–°
        run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "GitHub Actions"
          git add adblock.txt reports.txt README.md
          git commit -m "è‡ªåŠ¨æ›´æ–°è§„åˆ™ $(date -u +%Y%m%d_%H%M%S)"
          git push origin main

      # ä¿æ´»æœåŠ¡ï¼šé˜²æ­¢ GitHub æš‚åœ Actions
      - name: ä¿æŒ Actions æ´»è·ƒ
        uses: gautamkrishnar/keepalive-workflow@v1
        with:
          commit_message: "ğŸ”§ ä¿æŒ Actions æ´»è·ƒ"
          time_elapsed: 25  # 25å¤©æ— æäº¤æ—¶è‡ªåŠ¨åˆ›å»ºç©ºæäº¤
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
